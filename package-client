#!/usr/bin/env bash
# Package the client for distribution
set -euo pipefail

DIR="$(cd "$(dirname "$0")" && pwd)"
GAME="${1:-demo}"
OUTPUT="$DIR/dist/${GAME}-dist"

echo "Packaging client to: $OUTPUT/"

rm -rf "$OUTPUT"
mkdir -p "$OUTPUT"

# Copy from new directory structure (bin/, lib/)
cp -r "$DIR/dist/bin" "$OUTPUT/"
cp -r "$DIR/dist/lib" "$OUTPUT/"
cp "$DIR/dist/${GAME}_run" "$OUTPUT/"

# Copy runtime assets
cp -r "$DIR/shaders" "$OUTPUT/"
cp -r "$DIR/models" "$OUTPUT/"
cp -r "$DIR/fonts" "$OUTPUT/"

# Create a simple README
cat > "$OUTPUT/README.txt" << 'EOF'
Demo Game

Requirements:
  macOS (Apple Silicon) with XCode Command Line Tools installed
  (run: xcode-select --install)

First time setup (remove macOS quarantine after download):
  xattr -cr .

To run:
  ./demo_run

Controls:
  WASD - Move
  Mouse - Look
  Space - Jump
  ESC - Quit

Multiplayer:
  ./demo_run                    - Solo mode (no networking)
  ./demo_run server             - Start dedicated server
  ./demo_run server <port>      - Start server on specific port
  ./demo_run client             - Connect to localhost
  ./demo_run client <ip>        - Connect to server at IP
  ./demo_run client <ip> <port> - Connect to server at IP:port
EOF

# Calculate size
SIZE=$(du -sh "$OUTPUT" | cut -f1)
echo ""
echo "Package created: $OUTPUT/ ($SIZE)"
echo ""
echo "To create zip: cd dist && zip -r ${GAME}-dist.zip ${GAME}-dist"
